<?php

namespace Model\Repository;

use Model;

/**
 * Class StatusRepository
 * @package Model\Repository
 * @table TPP_STATUS
 * @entity StatusEntity
 * 
 */
class StatusRepository extends ARepository {

//	public function findByCompany($company_id) {
//		$row = $this->connection->select('*')
//				->from($this->getTable())
//				->where('ID_COMPANY = %i', $company_id)
//				->fetchAll();
//
//		return $this->createEntities($row);
//	}

	public function findByCompanyAndSpool($company_id, $spool_id) {
		$row = $this->connection->select('*')
				->from($this->getTable())
				->where('ID_COMPANY = %i', $company_id)
				->where('ID_SPOOL = %i', $spool_id)
				->fetch();

		if ($row === false) {
			throw new \Exception('Entity was not found.');
		}
		return $this->createEntity($row);
	}
	
	
	public function findByCompany($company_id, array $storedProcParams = NULL) {

		if ((!$storedProcParams) or (!isSet($storedProcParams['pageSize']))) {

			$row = $this->connection->select('*')
					->from($this->getTable())
					->where('ID_COMPANY = %i ', $company_id);
								
			if($storedProcParams) $row = $this->prepareSelectParams($row, $storedProcParams);
			$row = $row->fetchAll();
			
		} else {
			$where = " ID_COMPANY = $company_id ";
			
			$command = $this->prepareStoredProcParams($where, $storedProcParams);

//			$orderBy = null;
//			$ascOrDesc = null;
//
//			$pageSize = $storedProcParams['pageSize'];
//
//			$offset = $storedProcParams['offset'];
//
//			if (isSet($storedProcParams['orderBy'])) {
//				$orderBy = $storedProcParams['orderBy'];
//				if (isSet($storedProcParams['ascOrDesc']))
//					$ascOrDesc = $storedProcParams['ascOrDesc'];
//			}
//
//			$where = " ID_COMPANY = $company_id AND ID_SPOOL = $spool_id ";
//
//			if (isSet($storedProcParams['where'])) {
//				foreach ($storedProcParams['where'] as $k => $v) {
//					$whereString = "AND $k $v";
//
//					$where = $where . ($whereString);
//				}
//			}
//
//			$command = "EXEC  [dbo].[PaginateTable] @TableName='[dbo].[TPP_DOCUMENT]', @PageSize= $pageSize, @CurrentPageIndex= $offset ";
//
//			//$where =" ' DOC_CUST_DOC_ID > 3 ' ";
//			if ($where)
//				$command = $command . ", @RowFilter= '$where' ";
//
//			if ($orderBy) {
//				$command = $command . ", @KeyField= ' $orderBy ' ";
//			}
//
//			if ($ascOrDesc) {
//				$command = $command . ", @AscOrDesc= '$ascOrDesc' ";
//			}

			$row = $this->connection->query($command)->fetchAll();
		}

		if ($row and count($row) > 0) {
			return $this->createEntities($row);
		} else {
			throw new \Exception('Entita nenalezena');
		}
	}

}
